<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CODA para estudios del microbioma Seminario del proyecto METACIRCLE - 4&nbsp; CODA en acción 😎:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./t3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">CODA en acción 😎:</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">CODA para estudios del microbioma Seminario del proyecto METACIRCLE</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introducción 👋</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t1.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Inconvenientes de trabajar con conteos absolutos y conteos normalizados 🤯</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t2.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Principios básicos del CODA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./t3.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reemplazos composicionales del <code>tool kit</code> tradicional 👀</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coda_ejemplo1.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">CODA en acción 😎:</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#carga-de-librerías-de-r-que-utilizaremos" id="toc-carga-de-librerías-de-r-que-utilizaremos" class="nav-link active" data-scroll-target="#carga-de-librerías-de-r-que-utilizaremos"><span class="toc-section-number">4.1</span>  Carga de librerías de R que utilizaremos</a></li>
  <li><a href="#carga-y-limpieza-de-los-datos" id="toc-carga-y-limpieza-de-los-datos" class="nav-link" data-scroll-target="#carga-y-limpieza-de-los-datos"><span class="toc-section-number">4.2</span>  Carga y limpieza de los datos</a></li>
  <li><a href="#tratamiento-de-los-ceros" id="toc-tratamiento-de-los-ceros" class="nav-link" data-scroll-target="#tratamiento-de-los-ceros"><span class="toc-section-number">4.3</span>  Tratamiento de los ceros</a></li>
  <li><a href="#géneros-que-aparecen-únicamente-en-un-tipo-de-muestra" id="toc-géneros-que-aparecen-únicamente-en-un-tipo-de-muestra" class="nav-link" data-scroll-target="#géneros-que-aparecen-únicamente-en-un-tipo-de-muestra"><span class="toc-section-number">4.4</span>  Géneros que aparecen únicamente en un tipo de muestra</a></li>
  <li><a href="#imputación-de-ceros-con-la-previa-de-jeffreys" id="toc-imputación-de-ceros-con-la-previa-de-jeffreys" class="nav-link" data-scroll-target="#imputación-de-ceros-con-la-previa-de-jeffreys"><span class="toc-section-number">4.5</span>  Imputación de ceros con la previa de Jeffreys</a></li>
  <li><a href="#imputación-de-ceros-con-geometric-bayesian-multiplicative" id="toc-imputación-de-ceros-con-geometric-bayesian-multiplicative" class="nav-link" data-scroll-target="#imputación-de-ceros-con-geometric-bayesian-multiplicative"><span class="toc-section-number">4.6</span>  Imputación de ceros con Geometric Bayesian multiplicative</a></li>
  <li><a href="#imputación-de-ceros-con-un-método-iterativo" id="toc-imputación-de-ceros-con-un-método-iterativo" class="nav-link" data-scroll-target="#imputación-de-ceros-con-un-método-iterativo"><span class="toc-section-number">4.7</span>  Imputación de ceros con un método Iterativo</a></li>
  <li><a href="#qué-método-para-imputar-los-ceros-es-mejor" id="toc-qué-método-para-imputar-los-ceros-es-mejor" class="nav-link" data-scroll-target="#qué-método-para-imputar-los-ceros-es-mejor"><span class="toc-section-number">4.8</span>  ¿Qué método para imputar los ceros es mejor?</a></li>
  <li><a href="#comparando-matrices-de-distancias-de-aitchison-valor-pequeño-indica-mejor." id="toc-comparando-matrices-de-distancias-de-aitchison-valor-pequeño-indica-mejor." class="nav-link" data-scroll-target="#comparando-matrices-de-distancias-de-aitchison-valor-pequeño-indica-mejor."><span class="toc-section-number">4.9</span>  Comparando matrices de distancias de Aitchison: valor pequeño indica mejor.</a></li>
  <li><a href="#si-se-quieren-filtrar-las-muestras-outliers" id="toc-si-se-quieren-filtrar-las-muestras-outliers" class="nav-link" data-scroll-target="#si-se-quieren-filtrar-las-muestras-outliers"><span class="toc-section-number">4.10</span>  Si se quieren filtrar las muestras outliers</a></li>
  <li><a href="#sin-filtrar-variables" id="toc-sin-filtrar-variables" class="nav-link" data-scroll-target="#sin-filtrar-variables"><span class="toc-section-number">4.11</span>  Sin filtrar variables</a>
  <ul class="collapse">
  <li><a href="#clustering-jerárquico" id="toc-clustering-jerárquico" class="nav-link" data-scroll-target="#clustering-jerárquico"><span class="toc-section-number">4.11.1</span>  Clustering jerárquico</a></li>
  </ul></li>
  <li><a href="#aldex" id="toc-aldex" class="nav-link" data-scroll-target="#aldex"><span class="toc-section-number">4.12</span>  ALDEx</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">CODA en acción 😎:</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Se obtuvieron muestras fecales, en diferentes momentos, de individuos sanos distribuidos en tres grupos de edad: infantes (I), adultos (A) y ancianos (E). La metagenómica se llevó para 218 muestras que superaron los controles de calidad.</p>
<p>Queremos responder las siguientes preguntas:</p>
<ul>
<li><p>¿Las abundancias de qué bichos marcan la diferencia entre dos o más tipos de muestra?</p></li>
<li><p>¿En qué pares de bichos cambia significativamente la diferencia entre sus proporciones entres dos tipos de muestras?</p></li>
</ul>
<section id="carga-de-librerías-de-r-que-utilizaremos" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="carga-de-librerías-de-r-que-utilizaremos"><span class="header-section-number">4.1</span> Carga de librerías de R que utilizaremos</h2>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-1_86f811bb1ecce9c098202070b51edcf9">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(compositions) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zCompositions) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ALDEx2) </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easyCODA)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(robCompositions)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coda4microbiome)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(propr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ppclust)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fclust)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"funcionsCODACesc.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="carga-y-limpieza-de-los-datos" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="carga-y-limpieza-de-los-datos"><span class="header-section-number">4.2</span> Carga y limpieza de los datos</h2>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-2_2cd7e2d996c1cbc7ec7da951d61b23ea">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span><span class="ot">=</span><span class="fu">read.table</span>(<span class="st">"count_table_otus.tsv"</span>,<span class="at">header=</span><span class="cn">TRUE</span>,<span class="at">sep=</span><span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(DF<span class="fl">.0</span>)<span class="ot">=</span>DF<span class="fl">.0</span>[,<span class="dv">1</span>]</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span><span class="ot">=</span>DF<span class="fl">.0</span>[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminando los _</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(DF<span class="fl">.0</span>)<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"_"</span>,<span class="st">"."</span>, <span class="fu">rownames</span>(DF<span class="fl">.0</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(DF<span class="fl">.0</span>)<span class="ot">=</span><span class="fu">gsub</span>(<span class="st">"_"</span>,<span class="st">"."</span>, <span class="fu">colnames</span>(DF<span class="fl">.0</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Las filas deben ser muestras y las columnas taxa </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span><span class="ot">=</span><span class="fu">t</span>(DF<span class="fl">.0</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(DF<span class="fl">.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 218 280</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 218 280</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Eliminamos las filas y columnas con 0</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span><span class="ot">=</span>DF<span class="fl">.0</span>[<span class="fu">apply</span>(DF<span class="fl">.0</span>, <span class="dv">1</span>, sum)<span class="sc">&gt;</span><span class="dv">0</span>,<span class="fu">apply</span>(DF<span class="fl">.0</span>, <span class="dv">2</span>, sum)<span class="sc">&gt;</span><span class="dv">0</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>mostres<span class="ot">=</span><span class="fu">rownames</span>(DF<span class="fl">.0</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>bitxos<span class="ot">=</span><span class="fu">colnames</span>(DF<span class="fl">.0</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(DF<span class="fl">.0</span>)<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">2</span>]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>Grups<span class="ot">=</span><span class="fu">as.factor</span>(<span class="fu">substr</span>(mostres,<span class="dv">1</span>,<span class="dv">1</span>)) </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>colors<span class="ot">=</span><span class="fu">c</span>(<span class="st">"green"</span>,<span class="st">"blue"</span>,<span class="st">"brown"</span>)[Grups] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tratamiento-de-los-ceros" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="tratamiento-de-los-ceros"><span class="header-section-number">4.3</span> Tratamiento de los ceros</h2>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-3_c3aa2b2099c6ffc1e8fc007c5b88197a">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Proporciones de ceros por muestras</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Zeros.row<span class="ot">=</span><span class="fu">apply</span>(DF<span class="fl">.0</span>,<span class="at">MARGIN=</span><span class="dv">1</span>,<span class="at">FUN=</span><span class="cf">function</span>(x){<span class="fu">length</span>(x[x<span class="sc">==</span><span class="dv">0</span>])<span class="sc">/</span><span class="fu">length</span>(x)}) </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Proporciones de ceros por taxa</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>Zeros.col<span class="ot">=</span><span class="fu">apply</span>(DF<span class="fl">.0</span>,<span class="at">MARGIN=</span><span class="dv">2</span>,<span class="at">FUN=</span><span class="cf">function</span>(x){<span class="fu">length</span>(x[x<span class="sc">==</span><span class="dv">0</span>])<span class="sc">/</span><span class="fu">length</span>(x)}) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Zeros.row,<span class="at">breaks=</span><span class="dv">20</span>,<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.9</span>),<span class="at">xlab=</span><span class="st">"No. of 0's"</span>, <span class="at">main=</span><span class="st">"Proportions of 0's in samples"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Zeros.col,<span class="at">breaks=</span><span class="dv">20</span>,<span class="at">freq=</span><span class="cn">FALSE</span>,<span class="at">xlab=</span><span class="st">"No. of 0's"</span>, <span class="at">main=</span><span class="st">"Proportions of 0 at taxa"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-4_7a9e5c9eca28c4e4d673d79663c768c0">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># zPatterns de la librería zCompositions</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">zPatterns</span>(DF<span class="fl">.0</span>,<span class="at">label=</span><span class="dv">0</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>,<span class="at">main=</span><span class="st">"Global"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Zero Patterns in global sample</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-5_986a7577f27bd01afe58dd282650c7b6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zPatterns</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"A"</span>,],<span class="at">label=</span><span class="dv">0</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>,<span class="at">main=</span><span class="st">"Global"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Zero Patterns in Adults samples</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-6_bf1320f0125d93032726641d942209c6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zPatterns</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"E"</span>,],<span class="at">label=</span><span class="dv">0</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>,<span class="at">main=</span><span class="st">"Global"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Zero Patterns in Ederly samples</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-7_715ee9eb195df65cb2f36f9cfba61168">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">zPatterns</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"I"</span>,],<span class="at">label=</span><span class="dv">0</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>,<span class="at">main=</span><span class="st">"Global"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
<p></p><figcaption class="figure-caption">Zero Patterns in Infants samples</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="géneros-que-aparecen-únicamente-en-un-tipo-de-muestra" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="géneros-que-aparecen-únicamente-en-un-tipo-de-muestra"><span class="header-section-number">4.4</span> Géneros que aparecen únicamente en un tipo de muestra</h2>
<ul>
<li>Solo en Adultos</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-8_d4fae935da07d9ea0a4b02e3369d4750">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomesA<span class="ot">=</span>bitxos[<span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"A"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span>)]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bitxos.nomesA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomesA<span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> x </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.196 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.254 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.260 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.270 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ul>
<li>Solo en los Ancianos (Elderly)</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-9_cec264d992a9db39c2db5ffe5fff026b">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomesE<span class="ot">=</span>bitxos[<span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"E"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span>)]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bitxos.nomesE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomesE<span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> x </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.147 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.153 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.165 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.214 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.216 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.217 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.234 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.239 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.246 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.251 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.253 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.257 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.261 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.271 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.273 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.278 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ul>
<li>Solo en los Infantes</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-10_5ceb5752687fb1f84edf66465dc6ce88">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomésI<span class="ot">=</span>bitxos[<span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"I"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span>)]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bitxos.nomésI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>bitxos.nomésI<span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> x </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.119 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.138 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.220 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.225 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.277 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.279 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<ul>
<li>Solo en uno</li>
</ul>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-11_812e518f065ca5562d023a9a6dd8f973">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Nomes.a.un<span class="ot">=</span><span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"A"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span> <span class="sc">|</span> <span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"E"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span> <span class="sc">|</span> <span class="fu">apply</span>(DF<span class="fl">.0</span>[Grups<span class="sc">!=</span><span class="st">"I"</span>,], <span class="dv">2</span>, sum)<span class="sc">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputación-de-ceros-con-la-previa-de-jeffreys" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="imputación-de-ceros-con-la-previa-de-jeffreys"><span class="header-section-number">4.5</span> Imputación de ceros con la previa de Jeffreys</h2>
<p>Se asume que los valores no cero siguen una distribución log-normal pero están truncados en cero. Los ceros están presentes debido a un valor subyacente que se encuentra por debajo del umbral de detección. En este caso se ha puesto una previa no informativa. Los parámetros de estiman via MCMC.</p>
<p>Los ceros se reemplazan con los valores de la distribución predictiva posterior.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-12_a87dcf60b23a9ad16e9c74de5eb2abeb">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cmultRepl de la librería zCompositions Bayesian-Multiplicative replacement of count zeros</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># previa de Jeffreys 1/2, todos los valores tienen la misma probabilidad de ocurrir.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>DF.J<span class="ot">=</span><span class="fu">cmultRepl</span>(DF<span class="fl">.0</span>, <span class="at">method=</span><span class="st">"user"</span>, <span class="at">t=</span><span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">2</span>],<span class="at">nrow=</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">1</span>],<span class="at">ncol=</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">2</span>]),<span class="at">s=</span><span class="fu">rep</span>(<span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">2</span>,<span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">1</span>]),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">output=</span><span class="st">"p-counts"</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputación-de-ceros-con-geometric-bayesian-multiplicative" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="imputación-de-ceros-con-geometric-bayesian-multiplicative"><span class="header-section-number">4.6</span> Imputación de ceros con Geometric Bayesian multiplicative</h2>
<p>Se asume que los valores observados no cero siguen una distribución geométrica (modeliza la probabilidad de que ocurra el primer éxito en una serie de ensayos independientes de Bernoulli, donde un éxito es la observación de un valor no cero). Por lo tanto, los ceros se consideran “fracasos” en esta distribución.</p>
<p>Se estima el parámetro de la distribución geométrica a partir de los valores observados no cero en el conjunto de datos. Se utiliza una distribución previa para el parámetro de la distribución geométrica. Se obtiene la distribución posterior del parámetro con la que se generan valores imputados para los ceros.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-13_bd75c5a9bd715d7d6c6744b72a946f04">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Este es el método por defecto de cmultRepl </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hay que quitar columnas con solo una entrada diferente a 0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>Unics<span class="ot">=</span><span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>, <span class="dv">2</span>, <span class="cf">function</span>(x){<span class="fu">length</span>(<span class="fu">which</span>(x<span class="sc">&gt;</span><span class="dv">0</span>))})<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>bitxos.unics<span class="ot">=</span>bitxos[Unics]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(bitxos.unics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bitxos.unics<span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span><span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.138 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.220 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.251 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Damos un vistazo a lo que nos perderemos si las quitamos: Sus frecuencias relativas dentro de sus muestras únicas</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-14_2d17c5b5d7697abe53c296b05910e4b8">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>Què.ens.perdem<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(Unics))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(Unics)){</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  y<span class="ot">=</span><span class="fu">attr</span>(Unics,<span class="st">"names"</span>)[i]</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">=</span><span class="fu">which</span>(DF<span class="fl">.0</span>[,y]<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  Què.ens.perdem[i]<span class="ot">=</span>DF<span class="fl">.0</span>[x,y]<span class="sc">/</span><span class="fu">sum</span>(DF<span class="fl">.0</span>[x,])</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Què.ens.perdem,<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.024063 0.001049 0.000288</code></pre>
</div>
</div>
<p>La matriz con los ceros imputados …</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-15_2043ba3662e75f6b11ed71954d8c480b">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>U<span class="ot">=</span>DF<span class="fl">.0</span>[,<span class="sc">-</span>Unics]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>DF.GBM<span class="ot">=</span><span class="fu">cmultRepl</span>(DF<span class="fl">.0</span>U,<span class="at">method=</span><span class="st">"GBM"</span>,<span class="at">output=</span><span class="st">"p-counts"</span>,<span class="at">suppress.print=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>bitxos.nounics<span class="ot">=</span>bitxos[<span class="sc">-</span>Unics]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputación-de-ceros-con-un-método-iterativo" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="imputación-de-ceros-con-un-método-iterativo"><span class="header-section-number">4.7</span> Imputación de ceros con un método Iterativo</h2>
<p>El método EM se basa en la idea de maximizar una función de verosimilitud incompleta, donde se asume que los datos faltantes son valores no observados o “datos ocultos”.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-16_4ea5b64550cbad1cad45fa47e250a597">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># impRZilr de la librería robCompositions</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tarda mucho ... </span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># DF.0n=as.data.frame(DF.0)</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># DF.0n=as.data.frame(apply(DF.0n,MARGIN=2,as.numeric))</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># DF.It=impRZilr(DF.0n, eps=0.05, method = "pls", dl=rep(1, dim(DF.0)[2]),maxit = 10,verbose = FALSE)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(DF.It, file="DFItnou.RData")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-17_8e49d14862bd51574042f835b3b68311">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>DF.It<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"DFItnou.RData"</span>)<span class="sc">$</span>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="qué-método-para-imputar-los-ceros-es-mejor" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="qué-método-para-imputar-los-ceros-es-mejor"><span class="header-section-number">4.8</span> ¿Qué método para imputar los ceros es mejor?</h2>
<p>(Lubbe-Filznoser-Templ Chemolab 2021)</p>
<p>Comparando matrices de correlaciones de Kynclova-Hron-Filzmoser: un valor pequeño indica que el método es mejor.</p>
<p>La función <code>corCoDa</code> del paquete <code>robCompositions</code> que las calcula no aguanta matrices grandes (al menos en el portátil), por lo tanto lo hacemos por muestreo.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-18_cbfb1d1124b6ed4089714d31fa6ae624">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sustitución de los ceros por algo muy pequeño</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># multRepl de la librería zCompositions</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>DF.<span class="fl">0.</span>alt<span class="ot">=</span><span class="fu">multRepl</span>(DF<span class="fl">.0</span>,<span class="at">dl=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(DF<span class="fl">.0</span>)),<span class="at">frac=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">12</span>),<span class="at">label=</span><span class="dv">0</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>DF.<span class="fl">0.</span>alt.U<span class="ot">=</span>DF.<span class="fl">0.</span>alt[,<span class="sc">-</span>Unics]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-19_77ba5db6ffc24a1b7dbbc7ada0691803">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># X Y con las mismas dimensiones</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># m &lt; 30 o  da NaN</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>f<span class="ot">=</span><span class="cf">function</span>(X,Y,m){</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">sample</span>(<span class="fu">dim</span>(X)[<span class="dv">2</span>],m)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">/</span>m)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((<span class="fu">corCoDa</span>(X[,x])<span class="sc">-</span><span class="fu">corCoDa</span>(Y[,x]))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">200</span>,<span class="fu">f</span>(DF.<span class="fl">0.</span>alt,DF.J,<span class="dv">25</span>)))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">200</span>,<span class="fu">f</span>(DF.<span class="fl">0.</span>alt.U,DF.GBM,<span class="dv">25</span>)))</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">replicate</span>(<span class="dv">200</span>,<span class="fu">f</span>(DF.<span class="fl">0.</span>alt,DF.It,<span class="dv">25</span>)))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 0.01688433 0.01664001</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 0.009403911 0.009399878</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co"># [1] 0.06253841 0.05720421</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparando-matrices-de-distancias-de-aitchison-valor-pequeño-indica-mejor." class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="comparando-matrices-de-distancias-de-aitchison-valor-pequeño-indica-mejor."><span class="header-section-number">4.9</span> Comparando matrices de distancias de Aitchison: valor pequeño indica mejor.</h2>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-20_e4ee63d5b5186334a7571e2f9aadfb04">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((<span class="fu">aDist</span>(DF.<span class="fl">0.</span>alt)<span class="sc">-</span><span class="fu">aDist</span>(DF.J))<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20279.85</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(DF<span class="fl">.0</span>U)[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((<span class="fu">aDist</span>(DF.<span class="fl">0.</span>alt.U)<span class="sc">-</span><span class="fu">aDist</span>(DF.GBM))<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 19972.44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(DF<span class="fl">.0</span>)[<span class="dv">1</span>])<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fu">sum</span>((<span class="fu">aDist</span>(DF.<span class="fl">0.</span>alt)<span class="sc">-</span><span class="fu">aDist</span>(DF.It))<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11971.71</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-21_d9f73f2687d4160d9e555d4f60cdf60a">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Imputa0<span class="ot">=</span><span class="fu">c</span>(<span class="st">"J"</span>,<span class="st">"GBM"</span>,<span class="st">"It"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>Imputa0<span class="ot">=</span><span class="st">"GBM"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (Imputa0<span class="sc">==</span><span class="st">"J"</span>){</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    DF<span class="ot">=</span>DF.J</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (Imputa0<span class="sc">==</span><span class="st">"GBM"</span>){</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  DF<span class="fl">.0</span><span class="ot">=</span>DF<span class="fl">.0</span>U</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  DF<span class="ot">=</span>DF.GBM</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  bitxos<span class="ot">=</span>bitxos.nounics</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (Imputa0<span class="sc">==</span><span class="st">"It"</span>){</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    DF<span class="ot">=</span>DF.It</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="si-se-quieren-filtrar-las-muestras-outliers" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="si-se-quieren-filtrar-las-muestras-outliers"><span class="header-section-number">4.10</span> Si se quieren filtrar las muestras outliers</h2>
<p>Quitamos muestras que contribuyen a tener mucha varianza</p>
<p>Utilizó codaSeq.outlier de funcionsCODACesc.R adaptada de EasyCODA, que le da error</p>
<p>La función codaSeq.outlier ayuda a identificar observaciones que se desvían significativamente de la estructura típica de las composiciones.</p>
<p>El algoritmo de detección de outliers implementado en codaSeq.outlier se basa en la suposición de que los datos de composición siguen una distribución log-ratio multivariada.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-22_d066f75be8f0632caa8b3cbfe60e3518">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>DF.CLR<span class="ot">=</span><span class="fu">acomp</span>(DF)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>CSOut<span class="ot">=</span><span class="fu">codaSeq.outlier</span>(DF.CLR, <span class="at">plot.me=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>outliers<span class="ot">=</span>CSOut<span class="sc">$</span>bad</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>bones<span class="ot">=</span>CSOut<span class="sc">$</span>good</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Las muestras outliers son</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-23_161eb91cb276973a9113a78b6c532007">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mostres[outliers]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A04T4" "A05T1" "A07T2" "A08T4" "A08T6" "E01T1" "E01T2" "E06T4" "E09T2"
[10] "E10T3" "I01T2" "I01T4" "I02T7" "I05T2" "I07T4" "I07T6" "I07T7" "I09T2"
[19] "I10T6"</code></pre>
</div>
</div>
<p>Si quitamos estas muestras, tenemos que volver a controlar que no nos quede ninguna columna de 0s</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-24_58240cc8088a02155ae8dbe3a2121d01">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>B<span class="ot">=</span>DF<span class="fl">.0</span>[bones,]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>conserv<span class="ot">=</span><span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>B, <span class="dv">2</span>, sum)<span class="sc">&gt;</span><span class="dv">0</span>) </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>B<span class="ot">=</span>DF<span class="fl">.0</span>B[ ,conserv]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-25_642ef2d1e9b0b601119c14911a6d210c">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># si se emplea DF.It, igual conviene re-calcularlo porque depende de las muestras</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hay que quitar bichos que hayan quedado a 0 en todo</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>conserv<span class="ot">=</span><span class="fu">which</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>B, <span class="dv">2</span>, sum)<span class="sc">&gt;</span><span class="dv">0</span>) </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>B<span class="ot">=</span>DF<span class="fl">.0</span>B[ ,conserv]</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>Bn<span class="ot">=</span><span class="fu">as.data.frame</span>(DF<span class="fl">.0</span>B)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>DF<span class="fl">.0</span>Bn<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">apply</span>(DF<span class="fl">.0</span>Bn,<span class="at">MARGIN=</span><span class="dv">2</span>,as.numeric))</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>DFB.It<span class="ot">=</span><span class="fu">impRZilr</span>(DF<span class="fl">.0</span>Bn, <span class="at">eps=</span><span class="fl">0.05</span>, <span class="at">method =</span> <span class="st">"pls"</span>, <span class="at">dl=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>B)[<span class="dv">2</span>]),<span class="at">maxit =</span> <span class="dv">10</span>,<span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(DFB.It, <span class="at">file=</span><span class="st">"DFItBnou.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Con la función <code>QuinesMostres</code> indicamos si cogemos solo las muestras buenas o todas</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-26_ff599f3f2dc0eacab2ef18170e7abe78">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#QuinesMostres=c("totes","bones") </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>QuinesMostres<span class="ot">=</span><span class="st">"bones"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (QuinesMostres<span class="sc">==</span><span class="st">"bones"</span>){</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  DF<span class="fl">.0</span><span class="ot">=</span>DF<span class="fl">.0</span>B</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  DF<span class="ot">=</span>DF[bones,conserv]</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  Grups<span class="ot">=</span>Grups[bones]</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>colors<span class="ot">=</span>colors[bones]</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>mostres<span class="ot">=</span>mostres[bones]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    bitxos<span class="ot">=</span>bitxos[conserv]</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>DF.CLR<span class="ot">=</span><span class="fu">acomp</span>(DF)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>DF.prop<span class="ot">=</span><span class="fu">t</span>(<span class="fu">apply</span>(DF, <span class="dv">1</span>, <span class="cf">function</span>(x){x<span class="sc">/</span><span class="fu">sum</span>(x)}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sin-filtrar-variables" class="level2" data-number="4.11">
<h2 data-number="4.11" class="anchored" data-anchor-id="sin-filtrar-variables"><span class="header-section-number">4.11</span> Sin filtrar variables</h2>
<p>No hacemos biplot porque con tanta variable no se ve nada</p>
<section id="clustering-jerárquico" class="level3" data-number="4.11.1">
<h3 data-number="4.11.1" class="anchored" data-anchor-id="clustering-jerárquico"><span class="header-section-number">4.11.1</span> Clustering jerárquico</h3>
<p>A diferencia del algoritmo de Ward estándar (agrupa observaciones similares en función de una medida de distancia entre ellas), donde todas las observaciones tienen el mismo peso, el enfoque ponderado permite considerar la importancia relativa de cada observación en el proceso de agrupamiento.</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-27_3235585f8245372dc6ccccaae7e019f2">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clustering jerárquico con distancias euclidianas con pesos</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Función WARD de EasyCODA, necesita que la matriz de clr's se calcule con la misma librería</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>DF.CLR.W<span class="ot">=</span><span class="fu">CLR</span>(DF)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>hc<span class="ot">=</span><span class="fu">WARD</span>(DF.CLR.W,<span class="at">weight=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>dend<span class="ot">=</span><span class="fu">as.dendrogram</span>(hc)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">labels_colors</span>(dend)<span class="ot">=</span>colors[hc<span class="sc">$</span>order]</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex=</span><span class="fl">0.75</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">cex=</span><span class="dv">1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># No dibujamos barplot de composiciones porque el gráfico no es informativo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Matriz para entender los resultados:</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-28_90fb980d6b778d62892ff57f62630491">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>clust1<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">Orig=</span>Grups[hc<span class="sc">$</span>order],</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">clust=</span><span class="fu">cutree</span>(dend, <span class="at">k =</span> <span class="dv">3</span>)[<span class="fu">order.dendrogram</span>(dend)])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clust1)<span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> 1 </th>
   <th style="text-align:right;"> 2 </th>
   <th style="text-align:right;"> 3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> A </td>
   <td style="text-align:right;"> 51 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> E </td>
   <td style="text-align:right;"> 25 </td>
   <td style="text-align:right;"> 28 </td>
   <td style="text-align:right;"> 16 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> I </td>
   <td style="text-align:right;"> 57 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 8 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
</section>
<section id="aldex" class="level2" data-number="4.12">
<h2 data-number="4.12" class="anchored" data-anchor-id="aldex"><span class="header-section-number">4.12</span> ALDEx</h2>
<p>Permite identificar características (como especies microbianas o genes) que muestran diferencias significativas entre grupos de muestras (A, E, I) utilizando un enfoque basado en la inferencia bayesiana. Las muestras se extraen de la distribución Dirichlet (la beta en el caso multivariado).</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-29_b4728047a6b06a84765506a5c56f4181">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>DF0.Aldex<span class="ot">=</span><span class="fu">rbind</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"A"</span>,],DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"E"</span>,], DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"I"</span>,])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>DF0.t<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(DF0.Aldex))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>conds<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"A"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"A"</span>,])[<span class="dv">1</span>]),<span class="fu">rep</span>(<span class="st">"E"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"E"</span>,])[<span class="dv">1</span>]), <span class="fu">rep</span>(<span class="st">"I"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"I"</span>,])[<span class="dv">1</span>]))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>x.clr.kw<span class="ot">=</span><span class="fu">aldex.clr</span>(DF0.t[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">conds=</span>conds[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">mc.samples=</span><span class="dv">10</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>mc.instances <span class="ot">&lt;-</span> <span class="fu">numMCInstances</span>(x.clr.kw)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>mc.all <span class="ot">&lt;-</span> <span class="fu">getMonteCarloInstances</span>(x.clr.kw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-30_f75accfcabb2580659d487702fe0f158">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>DF0.Aldex<span class="ot">=</span><span class="fu">rbind</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"A"</span>,],DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"E"</span>,], DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"I"</span>,])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>DF0.t<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">t</span>(DF0.Aldex))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>conds<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"A"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"A"</span>,])[<span class="dv">1</span>]),<span class="fu">rep</span>(<span class="st">"E"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"E"</span>,])[<span class="dv">1</span>]), <span class="fu">rep</span>(<span class="st">"I"</span>, <span class="fu">dim</span>(DF<span class="fl">.0</span>[Grups<span class="sc">==</span><span class="st">"I"</span>,])[<span class="dv">1</span>]))</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>x.clr.kw<span class="ot">=</span><span class="fu">aldex.clr</span>(DF0.t, <span class="at">conds=</span>conds, <span class="at">mc.samples=</span><span class="dv">1000</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>x.kw<span class="ot">=</span><span class="fu">aldex.kw</span>(x.clr.kw, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># valores esperados del test Kruskal-Wallis y un glm sobre los datos</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>mm<span class="ot">=</span><span class="fu">model.matrix</span>(<span class="sc">~</span>conds,<span class="fu">data.frame</span>(conds))</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>x.clr.glm<span class="ot">=</span><span class="fu">aldex.clr</span>(DF0.t, <span class="at">conds=</span>mm, <span class="at">mc.samples=</span><span class="dv">1000</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>x.glm<span class="ot">=</span><span class="fu">aldex.glm</span>(x.clr.glm, mm)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>x.tot<span class="ot">=</span><span class="fu">cbind</span>(bitxos,x.kw,x.glm) </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(x.tot, <span class="at">file=</span><span class="st">"xtotTotal.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-31_0c0941b8c2f5afb085c742050f89c237">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>x.tot<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"xtotTotal.RData"</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>x.tot<span class="sc">$</span>bitxos<span class="ot">=</span><span class="fu">paste0</span>(<span class="st">"OTU."</span>,<span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"00"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),<span class="fu">paste</span>(<span class="st">"0"</span>,<span class="dv">10</span><span class="sc">:</span><span class="dv">99</span>),<span class="dv">100</span><span class="sc">:</span><span class="dv">276</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-32_3248627cca82034a5ded3425e19782c7">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>x.tot<span class="ot">=</span><span class="fu">readRDS</span>(<span class="st">"xtotTotal.RData"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-33_e8d025bc0519bbbd8d003b07f0f8b47c">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x.tot)<span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> bitxos </th>
   <th style="text-align:right;"> kw.ep </th>
   <th style="text-align:right;"> kw.eBH </th>
   <th style="text-align:right;"> glm.ep </th>
   <th style="text-align:right;"> glm.eBH </th>
   <th style="text-align:right;"> Intercept::Est </th>
   <th style="text-align:right;"> Intercept::SE </th>
   <th style="text-align:right;"> Intercept::t.val </th>
   <th style="text-align:right;"> Intercept::pval </th>
   <th style="text-align:right;"> condsE:Est </th>
   <th style="text-align:right;"> condsE:SE </th>
   <th style="text-align:right;"> condsE:t.val </th>
   <th style="text-align:right;"> condsE:pval </th>
   <th style="text-align:right;"> condsI:Est </th>
   <th style="text-align:right;"> condsI:SE </th>
   <th style="text-align:right;"> condsI:t.val </th>
   <th style="text-align:right;"> condsI:pval </th>
   <th style="text-align:right;"> Intercept::pval.holm </th>
   <th style="text-align:right;"> condsE:pval.holm </th>
   <th style="text-align:right;"> condsI:pval.holm </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.00 1 </td>
   <td style="text-align:right;"> 0.0801547 </td>
   <td style="text-align:right;"> 0.1570136 </td>
   <td style="text-align:right;"> 0.0303225 </td>
   <td style="text-align:right;"> 0.0797589 </td>
   <td style="text-align:right;"> 11.554637 </td>
   <td style="text-align:right;"> 0.1854587 </td>
   <td style="text-align:right;"> 62.30798 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.3413483 </td>
   <td style="text-align:right;"> 0.2584491 </td>
   <td style="text-align:right;"> 1.3206900 </td>
   <td style="text-align:right;"> 0.1903230 </td>
   <td style="text-align:right;"> 0.6980545 </td>
   <td style="text-align:right;"> 0.2622782 </td>
   <td style="text-align:right;"> 2.6615681 </td>
   <td style="text-align:right;"> 0.0087659 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.9977548 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.00 2 </td>
   <td style="text-align:right;"> 0.0206440 </td>
   <td style="text-align:right;"> 0.0579031 </td>
   <td style="text-align:right;"> 0.8077564 </td>
   <td style="text-align:right;"> 0.8585892 </td>
   <td style="text-align:right;"> 10.371632 </td>
   <td style="text-align:right;"> 0.3250578 </td>
   <td style="text-align:right;"> 31.95125 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -0.2775871 </td>
   <td style="text-align:right;"> 0.4529898 </td>
   <td style="text-align:right;"> -0.6145031 </td>
   <td style="text-align:right;"> 0.5414810 </td>
   <td style="text-align:right;"> -0.1943723 </td>
   <td style="text-align:right;"> 0.4597011 </td>
   <td style="text-align:right;"> -0.4203944 </td>
   <td style="text-align:right;"> 0.6775020 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.00 3 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000001 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000001 </td>
   <td style="text-align:right;"> 11.002260 </td>
   <td style="text-align:right;"> 0.2578001 </td>
   <td style="text-align:right;"> 42.77776 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -1.3076398 </td>
   <td style="text-align:right;"> 0.3592617 </td>
   <td style="text-align:right;"> -3.6427641 </td>
   <td style="text-align:right;"> 0.0003698 </td>
   <td style="text-align:right;"> 1.0649519 </td>
   <td style="text-align:right;"> 0.3645844 </td>
   <td style="text-align:right;"> 2.9277117 </td>
   <td style="text-align:right;"> 0.0042881 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0972514 </td>
   <td style="text-align:right;"> 0.8239804 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.00 4 </td>
   <td style="text-align:right;"> 0.0005343 </td>
   <td style="text-align:right;"> 0.0031584 </td>
   <td style="text-align:right;"> 0.0136801 </td>
   <td style="text-align:right;"> 0.0424850 </td>
   <td style="text-align:right;"> 8.736565 </td>
   <td style="text-align:right;"> 0.5371141 </td>
   <td style="text-align:right;"> 16.30443 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -2.1272875 </td>
   <td style="text-align:right;"> 0.7485045 </td>
   <td style="text-align:right;"> -2.8451954 </td>
   <td style="text-align:right;"> 0.0060917 </td>
   <td style="text-align:right;"> -0.4423784 </td>
   <td style="text-align:right;"> 0.7595941 </td>
   <td style="text-align:right;"> -0.5828832 </td>
   <td style="text-align:right;"> 0.5672890 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.8664487 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.00 5 </td>
   <td style="text-align:right;"> 0.0017423 </td>
   <td style="text-align:right;"> 0.0078298 </td>
   <td style="text-align:right;"> 0.0006925 </td>
   <td style="text-align:right;"> 0.0041580 </td>
   <td style="text-align:right;"> 12.369761 </td>
   <td style="text-align:right;"> 0.1919890 </td>
   <td style="text-align:right;"> 64.43325 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> -0.8996720 </td>
   <td style="text-align:right;"> 0.2675496 </td>
   <td style="text-align:right;"> -3.3628596 </td>
   <td style="text-align:right;"> 0.0009802 </td>
   <td style="text-align:right;"> -0.0119042 </td>
   <td style="text-align:right;"> 0.2715135 </td>
   <td style="text-align:right;"> -0.0438439 </td>
   <td style="text-align:right;"> 0.9315986 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.2511886 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.00 6 </td>
   <td style="text-align:right;"> 0.0008415 </td>
   <td style="text-align:right;"> 0.0044561 </td>
   <td style="text-align:right;"> 0.0350900 </td>
   <td style="text-align:right;"> 0.0835593 </td>
   <td style="text-align:right;"> 9.693963 </td>
   <td style="text-align:right;"> 0.2458796 </td>
   <td style="text-align:right;"> 39.53140 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 0.0115472 </td>
   <td style="text-align:right;"> 0.3426497 </td>
   <td style="text-align:right;"> 0.0338475 </td>
   <td style="text-align:right;"> 0.9425424 </td>
   <td style="text-align:right;"> 0.8127551 </td>
   <td style="text-align:right;"> 0.3477263 </td>
   <td style="text-align:right;"> 2.3506040 </td>
   <td style="text-align:right;"> 0.0246736 </td>
   <td style="text-align:right;"> 0 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Aquí podemos basarnos en:</p>
<ul>
<li><p><code>kw.eBH</code>: ajuste de p-valores utilizando el método de Benjamini-Hochberg (BH) después de realizar un análisis de varianza de Kruskal-Wallis (KW).</p></li>
<li><p><code>glm.eBH</code>: ajuste de p-valores utilizando el método de Benjamini-Hochberg (BH) después de ajustar un modelo lineal generalizado (GLM)</p></li>
<li><p><code>model.condsE</code>: se refiere al modelo de regresión ajustado utilizando las variables de composición como predictores y la condición “condsE” como la variable de respuesta.</p></li>
</ul>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-34_21096c1cbbdfcec4af6e3e65d6583bc7">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>signif.p1<span class="ot">=</span><span class="fu">which</span>(x.tot<span class="sc">$</span>kw.eBH <span class="sc">&lt;</span> <span class="fl">0.01</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>signif.g1<span class="ot">=</span><span class="fu">which</span>(x.tot<span class="sc">$</span>glm.eBH <span class="sc">&lt;</span> <span class="fl">0.01</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>signif.p1<span class="ot">=</span><span class="fu">intersect</span>(signif.p1,signif.g1)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(signif.p1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>x.tot.sign<span class="ot">=</span>x.tot[signif.p1,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">19</span>,<span class="dv">20</span>)]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x.tot.sign)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"p-val KW corregit"</span>, <span class="st">"p-val glm corregit"</span>, <span class="st">"p-val E vs A corregit"</span>, <span class="st">"p-val I vs A corregit"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(x.tot.sign)<span class="ot">=</span>bitxos[signif.p1]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>x.tot.sign<span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> p-val KW corregit </th>
   <th style="text-align:right;"> p-val glm corregit </th>
   <th style="text-align:right;"> p-val E vs A corregit </th>
   <th style="text-align:right;"> p-val I vs A corregit </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> OTU.003 </td>
   <td style="text-align:right;"> 0.0000001 </td>
   <td style="text-align:right;"> 0.0000001 </td>
   <td style="text-align:right;"> 0.0972514 </td>
   <td style="text-align:right;"> 0.8239804 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.005 </td>
   <td style="text-align:right;"> 0.0078298 </td>
   <td style="text-align:right;"> 0.0041580 </td>
   <td style="text-align:right;"> 0.2511886 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.008 </td>
   <td style="text-align:right;"> 0.0000070 </td>
   <td style="text-align:right;"> 0.0000016 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000085 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.011 </td>
   <td style="text-align:right;"> 0.0010125 </td>
   <td style="text-align:right;"> 0.0059162 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0787355 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.013 </td>
   <td style="text-align:right;"> 0.0000433 </td>
   <td style="text-align:right;"> 0.0000009 </td>
   <td style="text-align:right;"> 0.2828991 </td>
   <td style="text-align:right;"> 0.5834326 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.016 </td>
   <td style="text-align:right;"> 0.0038849 </td>
   <td style="text-align:right;"> 0.0006962 </td>
   <td style="text-align:right;"> 0.0327502 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.020 </td>
   <td style="text-align:right;"> 0.0097656 </td>
   <td style="text-align:right;"> 0.0033890 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0918489 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.022 </td>
   <td style="text-align:right;"> 0.0000326 </td>
   <td style="text-align:right;"> 0.0000097 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0358061 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.025 </td>
   <td style="text-align:right;"> 0.0002163 </td>
   <td style="text-align:right;"> 0.0001919 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0091624 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.030 </td>
   <td style="text-align:right;"> 0.0000002 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0002360 </td>
   <td style="text-align:right;"> 0.0000002 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.034 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000011 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.038 </td>
   <td style="text-align:right;"> 0.0001000 </td>
   <td style="text-align:right;"> 0.0006898 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0438187 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.044 </td>
   <td style="text-align:right;"> 0.0000015 </td>
   <td style="text-align:right;"> 0.0000002 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000073 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.046 </td>
   <td style="text-align:right;"> 0.0011419 </td>
   <td style="text-align:right;"> 0.0006191 </td>
   <td style="text-align:right;"> 0.5639068 </td>
   <td style="text-align:right;"> 0.0063995 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.047 </td>
   <td style="text-align:right;"> 0.0001250 </td>
   <td style="text-align:right;"> 0.0001823 </td>
   <td style="text-align:right;"> 0.2585800 </td>
   <td style="text-align:right;"> 0.9991464 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.049 </td>
   <td style="text-align:right;"> 0.0053303 </td>
   <td style="text-align:right;"> 0.0072328 </td>
   <td style="text-align:right;"> 0.1026868 </td>
   <td style="text-align:right;"> 0.9789205 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.050 </td>
   <td style="text-align:right;"> 0.0000264 </td>
   <td style="text-align:right;"> 0.0002277 </td>
   <td style="text-align:right;"> 0.3148470 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.052 </td>
   <td style="text-align:right;"> 0.0001237 </td>
   <td style="text-align:right;"> 0.0075423 </td>
   <td style="text-align:right;"> 0.9952454 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.054 </td>
   <td style="text-align:right;"> 0.0013229 </td>
   <td style="text-align:right;"> 0.0097693 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.7449599 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.057 </td>
   <td style="text-align:right;"> 0.0000489 </td>
   <td style="text-align:right;"> 0.0000655 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.1825672 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.059 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000004 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.060 </td>
   <td style="text-align:right;"> 0.0002872 </td>
   <td style="text-align:right;"> 0.0042465 </td>
   <td style="text-align:right;"> 0.6414395 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.063 </td>
   <td style="text-align:right;"> 0.0004161 </td>
   <td style="text-align:right;"> 0.0014406 </td>
   <td style="text-align:right;"> 0.4197127 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.064 </td>
   <td style="text-align:right;"> 0.0000174 </td>
   <td style="text-align:right;"> 0.0001876 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0845730 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.066 </td>
   <td style="text-align:right;"> 0.0000025 </td>
   <td style="text-align:right;"> 0.0000036 </td>
   <td style="text-align:right;"> 0.0061348 </td>
   <td style="text-align:right;"> 0.0000254 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.067 </td>
   <td style="text-align:right;"> 0.0003092 </td>
   <td style="text-align:right;"> 0.0026454 </td>
   <td style="text-align:right;"> 0.7734519 </td>
   <td style="text-align:right;"> 0.0414771 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.075 </td>
   <td style="text-align:right;"> 0.0091920 </td>
   <td style="text-align:right;"> 0.0052941 </td>
   <td style="text-align:right;"> 0.1359825 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.077 </td>
   <td style="text-align:right;"> 0.0000837 </td>
   <td style="text-align:right;"> 0.0003245 </td>
   <td style="text-align:right;"> 0.9095772 </td>
   <td style="text-align:right;"> 0.9990152 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.078 </td>
   <td style="text-align:right;"> 0.0001277 </td>
   <td style="text-align:right;"> 0.0005558 </td>
   <td style="text-align:right;"> 0.7500225 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.086 </td>
   <td style="text-align:right;"> 0.0005582 </td>
   <td style="text-align:right;"> 0.0022955 </td>
   <td style="text-align:right;"> 0.1265078 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.088 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.091 </td>
   <td style="text-align:right;"> 0.0000012 </td>
   <td style="text-align:right;"> 0.0000026 </td>
   <td style="text-align:right;"> 0.6333928 </td>
   <td style="text-align:right;"> 0.4631056 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.096 </td>
   <td style="text-align:right;"> 0.0007613 </td>
   <td style="text-align:right;"> 0.0024963 </td>
   <td style="text-align:right;"> 0.7773785 </td>
   <td style="text-align:right;"> 0.9987909 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.100 </td>
   <td style="text-align:right;"> 0.0087198 </td>
   <td style="text-align:right;"> 0.0049639 </td>
   <td style="text-align:right;"> 0.4523354 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.101 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 1.0000000 </td>
   <td style="text-align:right;"> 0.0000138 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.102 </td>
   <td style="text-align:right;"> 0.0000000 </td>
   <td style="text-align:right;"> 0.0000053 </td>
   <td style="text-align:right;"> 0.9922000 </td>
   <td style="text-align:right;"> 0.0525332 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.111 </td>
   <td style="text-align:right;"> 0.0004223 </td>
   <td style="text-align:right;"> 0.0016563 </td>
   <td style="text-align:right;"> 0.3737696 </td>
   <td style="text-align:right;"> 0.0432119 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.113 </td>
   <td style="text-align:right;"> 0.0021340 </td>
   <td style="text-align:right;"> 0.0040426 </td>
   <td style="text-align:right;"> 0.1122496 </td>
   <td style="text-align:right;"> 1.0000000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.118 </td>
   <td style="text-align:right;"> 0.0000004 </td>
   <td style="text-align:right;"> 0.0000050 </td>
   <td style="text-align:right;"> 0.8946424 </td>
   <td style="text-align:right;"> 0.0804560 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> OTU.154 </td>
   <td style="text-align:right;"> 0.0010999 </td>
   <td style="text-align:right;"> 0.0060971 </td>
   <td style="text-align:right;"> 0.1554282 </td>
   <td style="text-align:right;"> 0.9981464 </td>
  </tr>
</tbody>
</table>

</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>prova<span class="ot">=</span><span class="fu">unlist</span>(<span class="fu">sapply</span>(<span class="fu">rownames</span>(x.tot.sign),<span class="at">FUN=</span><span class="cf">function</span>(x) <span class="fu">which</span>(x<span class="sc">==</span>x.tot<span class="sc">$</span>bitxos)))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(prova)<span class="ot">=</span><span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><font color="blue"> Si nos restringimos a estos bichos </font>:</p>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-35_e0e425c1508ebe263c8d80e573001a9d">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>DF.s<span class="ot">=</span>DF[,prova]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>DF.CLR<span class="ot">=</span><span class="fu">acomp</span>(DF.s) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-36_41568f1fe206b91c2a8384cd54767724">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>pcx<span class="ot">=</span><span class="fu">princomp</span>(DF.CLR,<span class="at">cor=</span><span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-37_daa043dd0e03dc26e16f4d4862ebf490">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coloredBiplot</span>(pcx, <span class="at">cex=</span><span class="fl">0.5</span>, <span class="at">col=</span><span class="st">"red"</span>,  <span class="at">arrow.len=</span><span class="dv">0</span>, <span class="at">scale=</span><span class="dv">1</span>,<span class="at">var.axes=</span><span class="cn">TRUE</span>,</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab=</span><span class="fu">paste</span>(<span class="st">"PC1"</span>, <span class="fu">round</span>(pcx<span class="sc">$</span>sdev[<span class="dv">1</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pcx<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>),<span class="dv">3</span>), <span class="at">sep=</span><span class="st">": "</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab=</span><span class="fu">paste</span>(<span class="st">"PC2"</span>, <span class="fu">round</span>(pcx<span class="sc">$</span>sdev[<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pcx<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>),<span class="dv">3</span>), <span class="at">sep=</span><span class="st">": "</span>),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlabs.col=</span>colors, <span class="at">main=</span><span class="st">"Form biplot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-hash="coda_ejemplo1_cache/html/unnamed-chunk-38_ed563b03332bcc28654ad66f0d3aa996">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>DF.CLR.W.s<span class="ot">=</span><span class="fu">CLR</span>(DF.s)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>hc2<span class="ot">=</span><span class="fu">WARD</span>(DF.CLR.W.s,<span class="at">weight=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>dend<span class="fl">.2</span><span class="ot">=</span><span class="fu">as.dendrogram</span>(hc2)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">labels_colors</span>(dend<span class="fl">.2</span>)<span class="ot">=</span>colors[hc2<span class="sc">$</span>order]</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>DFOr<span class="ot">=</span>DF.s[hc2<span class="sc">$</span>order,]</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Reordemanos las muestras para dibujar los barplot en el mismo orden</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>DFOr.CLR<span class="ot">=</span><span class="fu">acomp</span>(DFOr)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>d.names<span class="ot">=</span><span class="fu">colnames</span>(DF.s)[<span class="fu">order</span>(<span class="fu">apply</span>(DF.s, <span class="dv">2</span>, sum), <span class="at">decreasing=</span>T) ]</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>nb.cols<span class="ot">=</span><span class="fu">dim</span>(DF.s)[<span class="dv">2</span>]</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>colors.OTU<span class="ot">=</span><span class="fu">colorRampPalette</span>(<span class="fu">brewer.pal</span>(<span class="fu">length</span>(d.names),<span class="st">"Spectral"</span>))(nb.cols)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Dibujo</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="dv">2</span>,<span class="dv">2</span>, <span class="at">byrow=</span>T), <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">2</span>), <span class="at">height=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span><span class="fl">0.1</span>,<span class="at">cex=</span><span class="fl">0.75</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend<span class="fl">.2</span>, <span class="at">main =</span> <span class="st">""</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(DFOr.CLR, <span class="at">legend.text=</span>F, <span class="at">col=</span>colors.OTU, <span class="at">axisnames=</span>F, <span class="at">border=</span><span class="cn">NA</span>, <span class="at">xpd=</span>T,)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">+</span><span class="fl">0.1</span>,<span class="at">cex=</span><span class="dv">1</span>)</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span>,<span class="dv">20</span>), <span class="at">type =</span> <span class="st">"n"</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="st">"center"</span>, <span class="at">legend=</span>d.names, <span class="at">col=</span>colors.OTU, <span class="at">lwd=</span><span class="dv">5</span>, <span class="at">cex=</span>.<span class="dv">6</span>, <span class="at">border=</span><span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="coda_ejemplo1_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./t3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reemplazos composicionales del <code>tool kit</code> tradicional 👀</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>